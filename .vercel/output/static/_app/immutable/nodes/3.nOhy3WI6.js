import{s as C,m as P,a as y,o as I,f as h,g as A,i as $,p as k,l as O}from"../chunks/scheduler.nTQPeTYQ.js";import{S as R,i as j,b as N,c as T,a as q,m as B,t as G,d as J,e as L}from"../chunks/index.CanFk0Lh.js";import{b as v,g as U}from"../chunks/entry.DNyy5_P4.js";import{P as W}from"../chunks/public.g4KRRLrj.js";import{f as w,C as z,p as D}from"../chunks/pendingMessage.42fdAZRO.js";import{e as M,E as F}from"../chunks/cookiesAreEnabled.zumDw87_.js";import{u as H}from"../chunks/settings.BrXZiVB0.js";function K(o){let r,s,n,t;document.title=W;function c(e){o[6](e)}let d={loading:o[1],assistant:o[0].assistant,currentModel:w([...o[0].models,...o[0].oldModels],o[3].activeModel),models:o[0].models};return o[2]!==void 0&&(d.files=o[2]),s=new z({props:d}),P.push(()=>N(s,"files",c)),s.$on("message",o[7]),{c(){r=y(),T(s.$$.fragment)},l(e){I("svelte-1o4lg8n",document.head).forEach(h),r=A(e),q(s.$$.fragment,e)},m(e,a){$(e,r,a),B(s,e,a),t=!0},p(e,[a]){const l={};a&2&&(l.loading=e[1]),a&1&&(l.assistant=e[0].assistant),a&9&&(l.currentModel=w([...e[0].models,...e[0].oldModels],e[3].activeModel)),a&1&&(l.models=e[0].models),!n&&a&4&&(n=!0,l.files=e[2],k(()=>n=!1)),s.$set(l)},i(e){t||(G(s.$$.fragment,e),t=!0)},o(e){J(s.$$.fragment,e),t=!1},d(e){e&&h(r),L(s,e)}}}function Q(o,r,s){let n,{data:t}=r,c=!1,d=[];const e=H();O(o,e,i=>s(3,n=i));async function a(i){var u,p,_;try{s(1,c=!0);const m=t.models.map(E=>E.id);let f;m.includes(n.activeModel)?f=n.activeModel:m.includes((u=t.assistant)===null||u===void 0?void 0:u.modelId)?f=(p=t.assistant)===null||p===void 0?void 0:p.modelId:f=t.models[0].id;const g=await fetch(`${v}/conversation`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:f,preprompt:n.customPrompts[n.activeModel],assistantId:(_=t.assistant)===null||_===void 0?void 0:_._id})});if(!g.ok){M.set("Error while creating conversation, try again."),console.error("Error while creating conversation: "+await g.text());return}const{conversationId:S}=await g.json();D.set({content:i,files:d}),await U(`${v}/conversation/${S}`,{invalidateAll:!0})}catch(m){M.set(F.default),console.error(m)}finally{s(1,c=!1)}}function l(i){d=i,s(2,d)}const b=i=>a(i.detail);return o.$$set=i=>{"data"in i&&s(0,t=i.data)},[t,c,d,n,e,a,l,b]}class oe extends R{constructor(r){super(),j(this,r,Q,K,C,{data:0})}}export{oe as component};
